
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://cloudac7.github.io/catflow/reference/catflow/metad/fes/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../hills/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.10">
    
    
      
        <title>fes - catflow</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.fad675c6.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#catflow.metad.fes" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-color-scheme="default" data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="catflow" class="md-header__button md-logo" aria-label="catflow" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            catflow
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              fes
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/cloudac7/catflow" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cloudac7/catflow
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
    
  
  Welcome

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../get_start/" class="md-tabs__link">
        
  
    
  
  Get Start

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../Usage/" class="md-tabs__link">
        
  
    
  
  Usage

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  Code Reference

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="catflow" class="md-nav__button md-logo" aria-label="catflow" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    catflow
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/cloudac7/catflow" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cloudac7/catflow
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Welcome
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../../../get_start/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Get Start
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../../../Usage/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Usage
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Usage
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Usage/cluster_structures/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    团簇结构分析
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Usage/dpgen_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    分析DP-GEN任务
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../../../Usage/metadyn/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Metadynamics 分析
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
      
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Code Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Code Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    catflow
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1">
            <span class="md-nav__icon md-icon"></span>
            catflow
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../atomic/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    atomic
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1_1" id="__nav_4_1_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_1">
            <span class="md-nav__icon md-icon"></span>
            atomic
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../atomic/atomic_energy/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    atomic_energy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../atomic/utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../cmdline/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    cmdline
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1_2" id="__nav_4_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_2">
            <span class="md-nav__icon md-icon"></span>
            cmdline
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../cmdline/base/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    base
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../graph/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    graph
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1_3" id="__nav_4_1_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_3">
            <span class="md-nav__icon md-icon"></span>
            graph
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../graph/plotting/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    plotting
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_4" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    metad
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1_4" id="__nav_4_1_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4_1_4">
            <span class="md-nav__icon md-icon"></span>
            metad
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    fes
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    fes
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#catflow.metad.fes" class="md-nav__link">
    <span class="md-ellipsis">
      fes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface" class="md-nav__link">
    <span class="md-ellipsis">
      FreeEnergySurface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FreeEnergySurface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.find_minima" class="md-nav__link">
    <span class="md-ellipsis">
      find_minima()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.from_hills" class="md-nav__link">
    <span class="md-ellipsis">
      from_hills()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.generate_cv_map" class="md-nav__link">
    <span class="md-ellipsis">
      generate_cv_map()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.get_e_beta_c" class="md-nav__link">
    <span class="md-ellipsis">
      get_e_beta_c()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.make_fes_original" class="md-nav__link">
    <span class="md-ellipsis">
      make_fes_original()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.plot" class="md-nav__link">
    <span class="md-ellipsis">
      plot()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.remove_cv" class="md-nav__link">
    <span class="md-ellipsis">
      remove_cv()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.remove_cvs" class="md-nav__link">
    <span class="md-ellipsis">
      remove_cvs()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.reweighting" class="md-nav__link">
    <span class="md-ellipsis">
      reweighting()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#catflow.metad.fes.PlottingFES" class="md-nav__link">
    <span class="md-ellipsis">
      PlottingFES
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PlottingFES">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.PlottingFES.plot_minima" class="md-nav__link">
    <span class="md-ellipsis">
      plot_minima()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../hills/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hills
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../profile/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    profile
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../string/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    string
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../structure/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    structure
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1_5" id="__nav_4_1_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_5">
            <span class="md-nav__icon md-icon"></span>
            structure
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../structure/cluster/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    cluster
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../structure/coordination_number/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    coordination_number
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../structure/dynamic_selection/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dynamic_selection
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../structure/lindemann_index/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lindemann_index
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tesla/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    tesla
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1_6" id="__nav_4_1_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_6">
            <span class="md-nav__icon md-icon"></span>
            tesla
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_6_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tesla/ai2_kit/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    ai2_kit
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1_6_1" id="__nav_4_1_6_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_6_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_6_1">
            <span class="md-nav__icon md-icon"></span>
            ai2_kit
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tesla/ai2_kit/exploration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    exploration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tesla/ai2_kit/labeling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    labeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tesla/ai2_kit/task/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    task
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tesla/ai2_kit/training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    training
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_6_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tesla/base/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    base
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1_6_2" id="__nav_4_1_6_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_6_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_6_2">
            <span class="md-nav__icon md-icon"></span>
            base
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tesla/base/exploration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    exploration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tesla/base/labeling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    labeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tesla/base/task/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    task
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tesla/base/training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    training
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_6_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tesla/dpgen/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    dpgen
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1_6_3" id="__nav_4_1_6_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_4_1_6_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_6_3">
            <span class="md-nav__icon md-icon"></span>
            dpgen
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tesla/dpgen/exploration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    exploration
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tesla/dpgen/labeling/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    labeling
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tesla/dpgen/task/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    task
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tesla/dpgen/training/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    training
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1_7" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../utils/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    utils
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_4_1_7" id="__nav_4_1_7_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_4_1_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_1_7">
            <span class="md-nav__icon md-icon"></span>
            utils
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/files/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    files
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/lammps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    lammps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/log_factory/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    log_factory
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../utils/output/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    output
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#catflow.metad.fes" class="md-nav__link">
    <span class="md-ellipsis">
      fes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface" class="md-nav__link">
    <span class="md-ellipsis">
      FreeEnergySurface
    </span>
  </a>
  
    <nav class="md-nav" aria-label="FreeEnergySurface">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.find_minima" class="md-nav__link">
    <span class="md-ellipsis">
      find_minima()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.from_hills" class="md-nav__link">
    <span class="md-ellipsis">
      from_hills()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.generate_cv_map" class="md-nav__link">
    <span class="md-ellipsis">
      generate_cv_map()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.get_e_beta_c" class="md-nav__link">
    <span class="md-ellipsis">
      get_e_beta_c()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.make_fes_original" class="md-nav__link">
    <span class="md-ellipsis">
      make_fes_original()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.plot" class="md-nav__link">
    <span class="md-ellipsis">
      plot()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.remove_cv" class="md-nav__link">
    <span class="md-ellipsis">
      remove_cv()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.remove_cvs" class="md-nav__link">
    <span class="md-ellipsis">
      remove_cvs()
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.FreeEnergySurface.reweighting" class="md-nav__link">
    <span class="md-ellipsis">
      reweighting()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#catflow.metad.fes.PlottingFES" class="md-nav__link">
    <span class="md-ellipsis">
      PlottingFES
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PlottingFES">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#catflow.metad.fes.PlottingFES.plot_minima" class="md-nav__link">
    <span class="md-ellipsis">
      plot_minima()
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>fes</h1>

<div class="doc doc-object doc-module">



<a id="catflow.metad.fes"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">




<h2 id="catflow.metad.fes.FreeEnergySurface" class="doc doc-heading">
          <code>FreeEnergySurface</code>


<a href="#catflow.metad.fes.FreeEnergySurface" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">

  
      <p>Computes the free energy surface corresponding to the provided Hills object.</p>
<p>Usage:
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">catflow.metad.fes</span> <span class="kn">import</span> <span class="n">FreeEnergySurface</span>
<span class="n">fes</span> <span class="o">=</span> <span class="n">FreeEnergySurface</span><span class="p">(</span><span class="n">hills</span><span class="p">)</span>
</code></pre></div></p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>hills</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="catflow.metad.hills.Hills" href="../hills/#catflow.metad.hills.Hills">Hills</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Hills object used for computing the free energy surface.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>resolution</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The resolution of the free energy surface. Defaults to 256.</p>
            </div>
          </td>
          <td>
                <code>256</code>
          </td>
        </tr>
        <tr>
          <td><code>time_min</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The starting time step of simulation. Defaults to 0.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>time_max</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The ending time step of simulation. Defaults to None.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>catflow/metad/fes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">FreeEnergySurface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the free energy surface corresponding to the provided Hills object.</span>

<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    from catflow.metad.fes import FreeEnergySurface</span>
<span class="sd">    fes = FreeEnergySurface(hills)</span>
<span class="sd">    ```</span>

<span class="sd">    Args:</span>
<span class="sd">        hills (Hills): The Hills object used for computing the free energy surface.</span>
<span class="sd">        resolution (int, optional): \</span>
<span class="sd">            The resolution of the free energy surface. Defaults to 256.</span>
<span class="sd">        time_min (int): The starting time step of simulation. Defaults to 0.</span>
<span class="sd">        time_max (int, optional): The ending time step of simulation. Defaults to None.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">cvs</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">cv_min</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">cv_max</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">periodic</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="n">hills</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Hills</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cv_fes_range</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">cv_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">minima</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="n">resolution</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_hills</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span> 
        <span class="n">hills</span><span class="p">:</span> <span class="n">Hills</span><span class="p">,</span>
        <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a FES object from a Hills object.&quot;&quot;&quot;</span>
        <span class="n">fes</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>

        <span class="n">fes</span><span class="o">.</span><span class="n">cvs</span> <span class="o">=</span> <span class="n">hills</span><span class="o">.</span><span class="n">cvs</span>

        <span class="n">fes</span><span class="o">.</span><span class="n">hills</span> <span class="o">=</span> <span class="n">hills</span>
        <span class="n">fes</span><span class="o">.</span><span class="n">periodic</span> <span class="o">=</span> <span class="n">hills</span><span class="o">.</span><span class="n">periodic</span>
        <span class="n">fes</span><span class="o">.</span><span class="n">cv_name</span> <span class="o">=</span> <span class="n">hills</span><span class="o">.</span><span class="n">cv_name</span>

        <span class="n">fes</span><span class="o">.</span><span class="n">generate_cv_map</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fes</span>

    <span class="k">def</span> <span class="nf">generate_cv_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;generate CV map&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cv_min</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">cv_min</span><span class="p">)</span>
            <span class="n">cv_max</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">cv_max</span><span class="p">)</span>
            <span class="n">cv_range</span> <span class="o">=</span> <span class="n">cv_max</span> <span class="o">-</span> <span class="n">cv_min</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv_range</span> <span class="o">=</span> <span class="n">cv_range</span>

            <span class="n">cv_min</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">]</span> <span class="o">-=</span> <span class="n">cv_range</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.15</span>
            <span class="n">cv_max</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cv_range</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.15</span>
            <span class="n">cv_fes_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cv_max</span> <span class="o">-</span> <span class="n">cv_min</span><span class="p">)</span>

            <span class="c1"># generate remapped cv_min and cv_max</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv_min</span> <span class="o">=</span> <span class="n">cv_min</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv_max</span> <span class="o">=</span> <span class="n">cv_max</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv_fes_range</span> <span class="o">=</span> <span class="n">cv_fes_range</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_array</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">fes_array</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
        <span class="n">cv_min</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
        <span class="n">cv_max</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
        <span class="n">periodic</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
        <span class="n">cv_name</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span>
    <span class="p">):</span>
        <span class="n">fes</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>
        <span class="n">fes</span><span class="o">.</span><span class="n">fes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fes_array</span><span class="p">)</span>
        <span class="n">fes</span><span class="o">.</span><span class="n">cv_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cv_min</span><span class="p">)</span>
        <span class="n">fes</span><span class="o">.</span><span class="n">cv_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cv_max</span><span class="p">)</span>
        <span class="n">fes</span><span class="o">.</span><span class="n">cv_fes_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cv_max</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cv_min</span><span class="p">)</span>
        <span class="n">fes</span><span class="o">.</span><span class="n">periodic</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">periodic</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">fes</span><span class="o">.</span><span class="n">cv_name</span> <span class="o">=</span> <span class="n">cv_name</span>
        <span class="n">fes</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="n">resolution</span>
        <span class="n">fes</span><span class="o">.</span><span class="n">cvs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cv_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fes</span>

    <span class="k">def</span> <span class="nf">name_cv</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv_name</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">cv_name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;CV</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_e_beta_c</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">resolution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">kb</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.314e-3</span><span class="p">,</span>
        <span class="n">temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">300.0</span><span class="p">,</span>
        <span class="n">bias_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">15.0</span><span class="p">,</span>
        <span class="n">return_fes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Function used internally for summing hills in Hills object with the fast Bias Sum Algorithm. </span>
<span class="sd">        From which could also be quick to get e_beta_c for reweighting.</span>

<span class="sd">        Args:</span>
<span class="sd">            resolution (int, optional): \</span>
<span class="sd">                The resolution of the free energy surface. Defaults to 256.</span>
<span class="sd">            time_min (int): The starting time step of simulation. Defaults to 0.</span>
<span class="sd">            time_max (int, optional): The ending time step of simulation. Defaults to None.</span>
<span class="sd">            reweighting (bool, optional): \</span>
<span class="sd">                If True, the function of c(t) will be calculated and stored in `self.e_beta_c`.</span>
<span class="sd">                Defaults to False.</span>
<span class="sd">            kb (float, optional): The Boltzmann Constant in the energy unit. Defaults to 8.314e-3.</span>
<span class="sd">            temp (float, optional): The temperature of the simulation in Kelvins. Defaults to 300.0.</span>
<span class="sd">            bias_factor (float, optional): The bias factor used in the simulation. Defaults to 15.0.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Hills not loaded yet.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">time_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_min</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">time_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">cv</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="n">cvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span>

        <span class="n">cv_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_min</span>
        <span class="n">cv_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_max</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_fes_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv_fes_range</span> <span class="o">=</span> <span class="n">cv_max</span> <span class="o">-</span> <span class="n">cv_min</span>
        <span class="n">cv_fes_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_fes_range</span>

        <span class="n">cv_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">cv</span><span class="p">[</span><span class="n">time_min</span><span class="p">:</span><span class="n">time_max</span><span class="p">,</span> <span class="p">:</span><span class="n">cvs</span><span class="p">]</span> <span class="o">-</span>
             <span class="n">cv_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">resolution</span> <span class="o">/</span> <span class="n">cv_fes_range</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">sigma</span><span class="p">[:</span><span class="n">cvs</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
        <span class="n">sigma_res</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">resolution</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">cv_max</span> <span class="o">-</span> <span class="n">cv_min</span><span class="p">)</span>

        <span class="n">gauss_res</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">sigma_res</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gauss_res</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">_</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">gauss_res</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">gauss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gauss_kernel</span><span class="p">(</span><span class="n">gauss_res</span><span class="p">,</span> <span class="n">sigma_res</span><span class="p">)</span>
        <span class="n">gauss_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gauss</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

        <span class="n">fes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">resolution</span><span class="p">]</span> <span class="o">*</span> <span class="n">cvs</span><span class="p">)</span>
        <span class="n">e_beta_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cv_bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

        <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cv_bins</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
            <span class="n">fes_index_to_edit</span><span class="p">,</span> <span class="n">delta_fes</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">_sum_bias</span><span class="p">(</span>
                    <span class="n">gauss_center</span><span class="p">,</span> <span class="n">gauss</span><span class="p">,</span> <span class="n">cv_bins</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">cvs</span><span class="p">,</span> <span class="n">resolution</span>
                <span class="p">)</span>
            <span class="n">fes</span><span class="p">[</span><span class="n">fes_index_to_edit</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta_fes</span>

            <span class="n">local_fes</span> <span class="o">=</span> <span class="n">fes</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">fes</span><span class="p">)</span>
            <span class="n">exp_local_fes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">local_fes</span> <span class="o">/</span> <span class="p">(</span><span class="n">kb</span> <span class="o">*</span> <span class="n">temp</span><span class="p">))</span>

            <span class="n">numerator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">exp_local_fes</span><span class="p">)</span>
            <span class="n">denominator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">exp_local_fes</span> <span class="o">/</span> <span class="n">bias_factor</span><span class="p">)</span>
            <span class="n">e_beta_c</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>
        <span class="k">if</span> <span class="n">return_fes</span><span class="p">:</span>
            <span class="n">fes</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">fes</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">e_beta_c</span><span class="p">,</span> <span class="n">fes</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">e_beta_c</span>

    <span class="k">def</span> <span class="nf">_gauss_kernel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gauss_res</span><span class="p">,</span> <span class="n">sigma_res</span><span class="p">):</span>

        <span class="n">gauss_center</span> <span class="o">=</span> <span class="n">gauss_res</span> <span class="o">//</span> <span class="mi">2</span>
        <span class="n">grids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">gauss_res</span><span class="p">)</span>

        <span class="n">grids_flatten</span> <span class="o">=</span> <span class="n">grids</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">gauss_res</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">exponent</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span>
            <span class="o">-</span><span class="p">(</span><span class="n">grids_flatten</span> <span class="o">-</span> <span class="n">gauss_center</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">sigma_res</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> 
            <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">gauss</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">exponent</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">gauss_res</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">gauss</span>

    <span class="k">def</span> <span class="nf">_sum_bias</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">gauss_center</span><span class="p">,</span> <span class="n">gauss</span><span class="p">,</span> <span class="n">cv_bins</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">cvs</span><span class="p">,</span> <span class="n">resolution</span>
    <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Hills not loaded yet.&quot;</span><span class="p">)</span>

        <span class="c1"># create a meshgrid of the indexes of the fes that need to be edited</span>
        <span class="n">fes_index_to_edit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="n">gauss</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="c1"># create a mask to avoid editing indexes outside the fes</span>
        <span class="n">local_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">gauss</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cvs</span><span class="p">):</span>
            <span class="n">fes_index_to_edit</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cv_bins</span><span class="p">[</span><span class="n">d</span><span class="p">][</span><span class="n">line</span><span class="p">]</span> <span class="o">-</span> <span class="n">gauss_center</span><span class="p">[</span><span class="n">d</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">[</span><span class="n">d</span><span class="p">]:</span>
                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">fes_index_to_edit</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span>
                        <span class="n">fes_index_to_edit</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">resolution</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                <span class="c1"># if the cv is not periodic, remove the indexes outside the fes</span>
                <span class="n">local_mask</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="c1"># make sure the indexes are inside the fes</span>
            <span class="n">fes_index_to_edit</span><span class="p">[</span><span class="n">d</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mod</span><span class="p">(</span><span class="n">fes_index_to_edit</span><span class="p">[</span><span class="n">d</span><span class="p">],</span> <span class="n">resolution</span><span class="p">)</span>
        <span class="n">delta_fes</span> <span class="o">=</span> <span class="n">gauss</span> <span class="o">*</span> <span class="n">local_mask</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">heights</span><span class="p">[</span><span class="n">line</span><span class="p">]</span>
        <span class="n">fes_index_to_edit</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">fes_index_to_edit</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fes_index_to_edit</span><span class="p">,</span> <span class="n">delta_fes</span>

    <span class="k">def</span> <span class="nf">reweighting</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">colvar_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">e_beta_c</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
        <span class="n">cv_indexes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
        <span class="n">kb</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.314e-3</span><span class="p">,</span>
        <span class="n">temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">300.0</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reweights the free energy surface based on the given collective variables.</span>

<span class="sd">        Args:</span>
<span class="sd">            colvar_file (str): The path to the file containing the collective variables.</span>
<span class="sd">            e_beta_c (ArrayLike): The array of e^(-beta*C(t)) values.</span>
<span class="sd">            cv_indexes (Optional[List[int]], optional): The indexes of the collective variables to use. Defaults to None.</span>
<span class="sd">            resolution (int, optional): The resolution of the free energy surface. Defaults to 64.</span>
<span class="sd">            kb (float, optional): The Boltzmann constant. Defaults to 8.314e-3.</span>
<span class="sd">            temp (float, optional): The temperature in Kelvin. Defaults to 300.0.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.ndarray: The reweighted free energy surface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">colvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">colvar_file</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">cv_indexes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span>
            <span class="n">colvar_value</span> <span class="o">=</span> <span class="n">colvar</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="n">cvs</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cvs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cv_indexes</span><span class="p">)</span>
            <span class="n">colvar_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
                <span class="p">[</span><span class="n">colvar</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cv_indexes</span><span class="p">]</span>
            <span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">cv_array</span> <span class="o">=</span> <span class="n">colvar_value</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">colvar_value</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">cv_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cv_array</span><span class="p">)</span>
        <span class="n">cv_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">resolution</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">cv_array</span> <span class="o">/</span> <span class="n">cv_range</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">bias</span> <span class="o">=</span> <span class="n">colvar</span><span class="p">[:,</span> <span class="mi">9</span><span class="p">]</span>
        <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">resolution</span><span class="p">]</span> <span class="o">*</span> <span class="n">cvs</span><span class="p">)</span>

        <span class="n">e_beta_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">e_beta_c</span><span class="p">)</span>
        <span class="n">reweighted_fes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">e_beta_c</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">resolution</span><span class="p">]</span> <span class="o">*</span> <span class="n">cvs</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e_beta_c</span><span class="p">)):</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">cv_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
            <span class="n">probs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">kb</span> <span class="o">*</span> <span class="n">temp</span><span class="p">))</span> <span class="o">/</span> <span class="n">e_beta_c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">reweighted_fes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kb</span> <span class="o">*</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">reweighted_fes</span>

    <span class="k">def</span> <span class="nf">_calculate_dp2</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">time_min</span><span class="p">,</span> <span class="n">time_max</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Hills not loaded yet.&quot;</span><span class="p">)</span>

        <span class="n">cv_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_min</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_fes_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv_fes_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_max</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_min</span>
        <span class="n">cv_fes_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_fes_range</span>
        <span class="n">cvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span>

        <span class="n">dp2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">time_max</span> <span class="o">-</span> <span class="n">time_min</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">cv_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">cvs</span><span class="p">)):</span>
            <span class="n">dist_cv</span> <span class="o">=</span> \
                <span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">cv</span><span class="p">[</span><span class="n">time_min</span><span class="p">:</span><span class="n">time_max</span><span class="p">,</span> <span class="n">cv_idx</span><span class="p">]</span> <span class="o">-</span> \
                <span class="p">(</span><span class="n">cv_min</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">cv_fes_range</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">[</span><span class="n">cv_idx</span><span class="p">]:</span>
                <span class="n">dist_cv</span><span class="p">[</span><span class="n">dist_cv</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">0.5</span><span class="o">*</span><span class="n">cv_fes_range</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">+=</span> <span class="n">cv_fes_range</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                <span class="n">dist_cv</span><span class="p">[</span><span class="n">dist_cv</span> <span class="o">&gt;</span> <span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">cv_fes_range</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">-=</span> <span class="n">cv_fes_range</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">dp2_local</span> <span class="o">=</span> <span class="n">dist_cv</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> \
                <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">sigma</span><span class="p">[</span><span class="n">cv_idx</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
            <span class="n">dp2</span> <span class="o">+=</span> <span class="n">dp2_local</span>

        <span class="k">return</span> <span class="n">dp2</span>

    <span class="k">def</span> <span class="nf">make_fes_original</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">resolution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">time_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">time_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">n_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function internally used to sum Hills in the same way as Plumed `sum_hills`. </span>

<span class="sd">        Args:</span>
<span class="sd">            resolution (int, optional): \</span>
<span class="sd">                The resolution of the free energy surface. Defaults to 256.</span>
<span class="sd">            time_min (int): The starting time step of simulation. Defaults to 0.</span>
<span class="sd">            time_max (int, optional): The ending time step of simulation. Defaults to None.</span>
<span class="sd">            n_workers (int, optional): Number of workers for parallelization. Defaults to 2.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Hills not loaded yet.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span>

        <span class="n">cvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span>
        <span class="n">fes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">resolution</span><span class="p">]</span> <span class="o">*</span> <span class="n">cvs</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">time_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_min</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">time_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">time_max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">cv</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">time_limit</span> <span class="o">=</span> <span class="n">time_max</span> <span class="o">-</span> <span class="n">time_min</span>

        <span class="k">def</span> <span class="nf">calculate_fes</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
            <span class="n">dp2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_dp2</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">time_min</span><span class="p">,</span> <span class="n">time_max</span><span class="p">)</span>

            <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">time_limit</span><span class="p">)</span>
            <span class="n">tmp</span><span class="p">[</span><span class="n">dp2</span> <span class="o">&lt;</span> <span class="mf">6.25</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">heights</span><span class="p">[</span><span class="n">dp2</span> <span class="o">&lt;</span> <span class="mf">6.25</span><span class="p">]</span> <span class="o">*</span> \
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dp2</span><span class="p">[</span><span class="n">dp2</span> <span class="o">&lt;</span> <span class="mf">6.25</span><span class="p">])</span> <span class="o">*</span>
                 <span class="mf">1.00193418799744762399</span> <span class="o">-</span> <span class="mf">0.00193418799744762399</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="o">-</span><span class="n">tmp</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndindex</span><span class="p">(</span><span class="n">fes</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">n_workers</span><span class="p">)(</span>
            <span class="n">delayed</span><span class="p">(</span><span class="n">calculate_fes</span><span class="p">)(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
                <span class="n">fes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="n">fes</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">fes</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fes</span> <span class="o">=</span> <span class="n">fes</span>
        <span class="k">return</span> <span class="n">fes</span>

    <span class="k">def</span> <span class="nf">remove_cv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">CV</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
        <span class="n">kb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">energy_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;kJ/mol&quot;</span><span class="p">,</span>
        <span class="n">temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">300.0</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Remove a CV from an existing FES. </span>
<span class="sd">        The function first recalculates the FES to an array of probabilities. </span>
<span class="sd">        The probabilities are summed along the CV to be removed, </span>
<span class="sd">        and resulting probability distribution with 1 less dimension </span>
<span class="sd">        is converted back to FES. </span>

<span class="sd">        Interactivity was working in jupyter notebook/lab with &quot;%matplotlib widget&quot;.</span>

<span class="sd">        Args:</span>
<span class="sd">            CV (int): the index of CV to be removed. </span>
<span class="sd">            energy_unit (str): has to be either &quot;kJ/mol&quot; or &quot;kcal/mol&quot;. Defaults to be &quot;kJ/mol&quot;.</span>
<span class="sd">            kb (float, optional): the Boltzmann Constant in the energy unit. \</span>
<span class="sd">                Defaults to be None, which will be set according to energy_unit.</span>
<span class="sd">            temp (float) = temperature of the simulation in Kelvins.</span>

<span class="sd">        Return:</span>
<span class="sd">            New `FES` instance without the CV to be removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing CV </span><span class="si">{</span><span class="n">CV</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;FES not calculated yet. Use makefes() or makefes2() first.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">CV</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">cvs</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Error: The CV to remove is not available in this FES object.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">kb</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">energy_unit</span> <span class="o">==</span> <span class="s2">&quot;kJ/mol&quot;</span><span class="p">:</span>
                <span class="n">kb</span> <span class="o">=</span> <span class="mf">8.314e-3</span>
            <span class="k">elif</span> <span class="n">energy_unit</span> <span class="o">==</span> <span class="s2">&quot;kcal/mol&quot;</span><span class="p">:</span>
                <span class="n">kb</span> <span class="o">=</span> <span class="mf">8.314e-3</span> <span class="o">/</span> <span class="mf">4.184</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;Please give the Boltzmann Constant in the energy unit.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: You can not remove the only CV. &quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">probabilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">fes</span> <span class="o">/</span> <span class="p">(</span><span class="n">kb</span> <span class="o">*</span> <span class="n">temp</span><span class="p">))</span>
            <span class="n">new_prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">CV</span><span class="p">)</span>

            <span class="n">new_fes</span> <span class="o">=</span> <span class="n">FreeEnergySurface</span><span class="o">.</span><span class="n">from_hills</span><span class="p">(</span><span class="n">hills</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="p">)</span>
            <span class="n">new_fes</span><span class="o">.</span><span class="n">fes</span> <span class="o">=</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">*</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">new_prob</span><span class="p">)</span>
            <span class="n">new_fes</span><span class="o">.</span><span class="n">fes</span> <span class="o">=</span> <span class="n">new_fes</span><span class="o">.</span><span class="n">fes</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">new_fes</span><span class="o">.</span><span class="n">fes</span><span class="p">)</span>
            <span class="n">new_fes</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span>

            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
            <span class="n">mask</span><span class="p">[</span><span class="n">CV</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">new_fes</span><span class="o">.</span><span class="n">cv_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_min</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">new_fes</span><span class="o">.</span><span class="n">cv_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_max</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">new_fes</span><span class="o">.</span><span class="n">cv_fes_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_fes_range</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">new_fes</span><span class="o">.</span><span class="n">cv_name</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">new_fes</span><span class="o">.</span><span class="n">cvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span> <span class="o">-</span> <span class="mi">1</span>
            <span class="k">return</span> <span class="n">new_fes</span>

    <span class="k">def</span> <span class="nf">remove_cvs</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">CVs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
        <span class="n">kb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">energy_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;kJ/mol&quot;</span><span class="p">,</span>
        <span class="n">temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">300.0</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Remove multiple collective variables (CVs) from the free energy surface (FES).</span>

<span class="sd">        Args:</span>
<span class="sd">            CVs (List[int]): The list of CVs to be removed.</span>
<span class="sd">            kb (Optional[float], optional): The Boltzmann constant. Defaults to None.</span>
<span class="sd">            energy_unit (str, optional): The unit of energy. Defaults to &quot;kJ/mol&quot;.</span>
<span class="sd">            temp (float, optional): The temperature in Kelvin. Defaults to 300.0.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Fes: The new FES object with the specified CVs removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">fes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_cv</span><span class="p">(</span><span class="n">CVs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kb</span><span class="p">,</span> <span class="n">energy_unit</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">CVs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">CV</span> <span class="ow">in</span> <span class="n">CVs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
                <span class="k">if</span> <span class="n">fes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">fes</span> <span class="o">=</span> <span class="n">fes</span><span class="o">.</span><span class="n">remove_cv</span><span class="p">(</span><span class="n">CV</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">energy_unit</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fes</span>

    <span class="k">def</span> <span class="nf">set_fes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fes</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fes</span> <span class="o">=</span> <span class="n">fes</span>

    <span class="k">def</span> <span class="nf">find_minima</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Method for finding local minima on FES.</span>

<span class="sd">        Args:</span>
<span class="sd">            fes (Fes): The Fes object to find the minima on.</span>
<span class="sd">            nbins (int, default=8): The number of bins used to divide the FES.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;FES not calculated yet. Use make_fes_original() first.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Minima already found.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

        <span class="n">cv_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_min</span>
        <span class="n">cv_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_max</span>

        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nbins</span><span class="p">:</span>
            <span class="n">nbins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Number of bins must be an integer, it will be set to </span><span class="si">{</span><span class="n">nbins</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span> <span class="o">%</span> <span class="n">nbins</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolution of FES must be divisible by number of bins.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nbins</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of bins is too high.&quot;</span><span class="p">)</span>

        <span class="n">bin_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="o">/</span><span class="n">nbins</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndindex</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="n">nbins</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)):</span>
            <span class="c1"># index serve as bin number</span>
            <span class="n">_fes_slice</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
                <span class="nb">slice</span><span class="p">(</span>
                    <span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">bin_size</span><span class="p">,</span> <span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">bin_size</span>
                <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="n">fes_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fes</span><span class="p">[</span><span class="n">_fes_slice</span><span class="p">]</span>
            <span class="n">bin_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">fes_slice</span><span class="p">)</span>

            <span class="c1"># indexes of global minimum of a bin</span>
            <span class="n">bin_min_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span>
                <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">fes_slice</span><span class="p">),</span> <span class="n">fes_slice</span><span class="o">.</span><span class="n">shape</span>
            <span class="p">)</span>
            <span class="c1"># indexes of that minima in the original fes (indexes +1)</span>
            <span class="n">min_cv_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                <span class="n">bin_min_arg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">bin_size</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)</span>
            <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_min_arg</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="ow">and</span> \
                    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_min_arg</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">bin_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="c1"># if the minima is not on the edge of the bin</span>
                <span class="n">min_cv</span> <span class="o">=</span> <span class="p">(((</span><span class="n">min_cv_b</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cv_max</span><span class="o">-</span><span class="n">cv_min</span><span class="p">))</span><span class="o">+</span><span class="n">cv_min</span>
                <span class="n">local_minima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">bin_min</span><span class="p">,</span> <span class="mi">6</span><span class="p">)],</span> <span class="n">min_cv_b</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">min_cv</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
                <span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="n">local_minima</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="p">,</span> <span class="n">local_minima</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># if the minima is on the edge of the bin</span>
                <span class="n">around</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">))</span>

                <span class="k">for</span> <span class="n">product_index</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">):</span>
                    <span class="n">converted_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">product_index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> \
                        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">min_cv_b</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                    <span class="n">converted_index</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">]</span> <span class="o">=</span> \
                        <span class="n">converted_index</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">]</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span>

                    <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                        <span class="p">(</span><span class="n">converted_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">converted_index</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                    <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">around</span><span class="p">[</span><span class="n">product_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

                    <span class="k">elif</span> <span class="n">product_index</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">):</span>
                        <span class="n">around</span><span class="p">[</span><span class="n">product_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">around</span><span class="p">[</span><span class="n">product_index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fes</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span>
                            <span class="n">converted_index</span><span class="p">)]</span>

                <span class="k">if</span> <span class="p">(</span><span class="n">around</span> <span class="o">&gt;</span> <span class="n">bin_min</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                    <span class="n">min_cv</span> <span class="o">=</span> <span class="p">(((</span><span class="n">min_cv_b</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cv_max</span><span class="o">-</span><span class="n">cv_min</span><span class="p">))</span><span class="o">+</span><span class="n">cv_min</span>
                    <span class="n">local_minima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span>
                        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">bin_min</span><span class="p">,</span> <span class="mi">6</span><span class="p">)],</span> <span class="n">min_cv_b</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">min_cv</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
                    <span class="p">])</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="n">local_minima</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="p">,</span> <span class="n">local_minima</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No minima found.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span>
            <span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span>
                <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span>
            <span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cv_name</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CV</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)]</span>

        <span class="n">minima_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="p">),</span>
            <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Minimum&quot;</span><span class="p">,</span> <span class="s2">&quot;free energy&quot;</span><span class="p">]</span> <span class="o">+</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CV</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">bin&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)]</span> <span class="o">+</span>
            <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CV</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)]</span>
        <span class="p">)</span>
        <span class="n">minima_df</span><span class="p">[</span><span class="s2">&quot;Minimum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minima_df</span><span class="p">[</span><span class="s2">&quot;Minimum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="n">minima_df</span>

    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">png_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">cmap</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Colormap</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;RdYlBu_r&quot;</span><span class="p">,</span>
        <span class="n">energy_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;kJ/mol&quot;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">image_size</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
        <span class="n">levels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">96</span><span class="p">,</span>
        <span class="n">surface</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">surface_params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualizes the free energy surface (FES) using Matplotlib and PyVista.</span>

<span class="sd">        Usage:</span>
<span class="sd">        ```python</span>
<span class="sd">        fes.plot()</span>
<span class="sd">        ```</span>

<span class="sd">        Args:</span>
<span class="sd">            png_name (str, optional): If provided, the picture of FES will be saved under this name in the current working directory.</span>
<span class="sd">            cmap (str, default=&quot;RdYlBu_r&quot;): The Matplotlib colormap used to color the 2D or 3D FES.</span>
<span class="sd">            energy_unit (str, default=&quot;kJ/mol&quot;): The unit used in the description of the colorbar.</span>
<span class="sd">            xlabel, ylabel (str, optional): If provided, they will be used as labels for the graphs.</span>
<span class="sd">            image_size (List[int], default=[10,7]): The width and height of the picture.</span>
<span class="sd">            levels (int, optional): A list of free energy values for isosurfaces in FES. Defaults to be 20.</span>
<span class="sd">            dpi (int, default=96): The resolution of the picture.</span>
<span class="sd">            surface (bool, default=False): Whether to plot the 3D surface of the FES.</span>
<span class="sd">            surface_params (dict, optional): A dictionary of parameters to be passed to the PyVista plotter when plotting the 3D surface.</span>
<span class="sd">            **kwargs: Additional keyword arguments to be passed to the Matplotlib plotter.</span>

<span class="sd">        Returns:</span>
<span class="sd">            fig, ax: The Matplotlib figure and axis objects.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;FES not calculated yet. Use makefes() or makefes2() first.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>

        <span class="n">cvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span>

        <span class="k">if</span> <span class="n">cvs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">PlottingFES</span><span class="o">.</span><span class="n">_plot1d</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
                <span class="n">energy_unit</span><span class="o">=</span><span class="n">energy_unit</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="k">elif</span> <span class="n">cvs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">surface</span><span class="p">:</span>
                <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">PlottingFES</span><span class="o">.</span><span class="n">_surface_plot</span><span class="p">(</span>
                    <span class="bp">self</span><span class="p">,</span>
                    <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
                    <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
                    <span class="n">energy_unit</span><span class="o">=</span><span class="n">energy_unit</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">surface_params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                <span class="p">)</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">PlottingFES</span><span class="o">.</span><span class="n">_plot2d</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only 1D and 2D FES are supported.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">png_name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">png_name</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

    <span class="k">def</span> <span class="nf">plot_minima</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mark_color</span><span class="o">=</span><span class="s2">&quot;white&quot;</span><span class="p">,</span> <span class="n">png_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">PlottingFES</span><span class="o">.</span><span class="n">plot_minima</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mark_color</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">png_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">png_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="catflow.metad.fes.FreeEnergySurface.find_minima" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">find_minima</span><span class="p">(</span><span class="n">nbins</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span></code>

<a href="#catflow.metad.fes.FreeEnergySurface.find_minima" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Method for finding local minima on FES.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>fes</code></td>
          <td>
                <code>Fes</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Fes object to find the minima on.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nbins</code></td>
          <td>
                <code>int, default=8</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of bins used to divide the FES.</p>
            </div>
          </td>
          <td>
                <code>8</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>catflow/metad/fes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_minima</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Method for finding local minima on FES.</span>

<span class="sd">    Args:</span>
<span class="sd">        fes (Fes): The Fes object to find the minima on.</span>
<span class="sd">        nbins (int, default=8): The number of bins used to divide the FES.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;FES not calculated yet. Use make_fes_original() first.&quot;</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Minima already found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

    <span class="n">cv_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_min</span>
    <span class="n">cv_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_max</span>

    <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span> <span class="o">!=</span> <span class="n">nbins</span><span class="p">:</span>
        <span class="n">nbins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">nbins</span><span class="p">)</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Number of bins must be an integer, it will be set to </span><span class="si">{</span><span class="n">nbins</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span> <span class="o">%</span> <span class="n">nbins</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Resolution of FES must be divisible by number of bins.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">nbins</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="o">/</span><span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of bins is too high.&quot;</span><span class="p">)</span>

    <span class="n">bin_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="o">/</span><span class="n">nbins</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndindex</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="n">nbins</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)):</span>
        <span class="c1"># index serve as bin number</span>
        <span class="n">_fes_slice</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span>
            <span class="nb">slice</span><span class="p">(</span>
                <span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">bin_size</span><span class="p">,</span> <span class="p">(</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">bin_size</span>
            <span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">fes_slice</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fes</span><span class="p">[</span><span class="n">_fes_slice</span><span class="p">]</span>
        <span class="n">bin_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">fes_slice</span><span class="p">)</span>

        <span class="c1"># indexes of global minimum of a bin</span>
        <span class="n">bin_min_arg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">fes_slice</span><span class="p">),</span> <span class="n">fes_slice</span><span class="o">.</span><span class="n">shape</span>
        <span class="p">)</span>
        <span class="c1"># indexes of that minima in the original fes (indexes +1)</span>
        <span class="n">min_cv_b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="n">bin_min_arg</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">bin_size</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)</span>
        <span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_min_arg</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span> <span class="ow">and</span> \
                <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_min_arg</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">bin_size</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
            <span class="c1"># if the minima is not on the edge of the bin</span>
            <span class="n">min_cv</span> <span class="o">=</span> <span class="p">(((</span><span class="n">min_cv_b</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cv_max</span><span class="o">-</span><span class="n">cv_min</span><span class="p">))</span><span class="o">+</span><span class="n">cv_min</span>
            <span class="n">local_minima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span>
                <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">bin_min</span><span class="p">,</span> <span class="mi">6</span><span class="p">)],</span> <span class="n">min_cv_b</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">min_cv</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
            <span class="p">])</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="n">local_minima</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="p">,</span> <span class="n">local_minima</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># if the minima is on the edge of the bin</span>
            <span class="n">around</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">tuple</span><span class="p">([</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">product_index</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="p">[</span><span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">)]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">):</span>
                <span class="n">converted_index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">product_index</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">+</span> \
                    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">min_cv_b</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
                <span class="n">converted_index</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">]</span> <span class="o">=</span> \
                    <span class="n">converted_index</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">]</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span>

                <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
                    <span class="p">(</span><span class="n">converted_index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">converted_index</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
                <span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">mask</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">around</span><span class="p">[</span><span class="n">product_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

                <span class="k">elif</span> <span class="n">product_index</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">):</span>
                    <span class="n">around</span><span class="p">[</span><span class="n">product_index</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">around</span><span class="p">[</span><span class="n">product_index</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fes</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span>
                        <span class="n">converted_index</span><span class="p">)]</span>

            <span class="k">if</span> <span class="p">(</span><span class="n">around</span> <span class="o">&gt;</span> <span class="n">bin_min</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
                <span class="n">min_cv</span> <span class="o">=</span> <span class="p">(((</span><span class="n">min_cv_b</span><span class="o">+</span><span class="mf">0.5</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">res</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">cv_max</span><span class="o">-</span><span class="n">cv_min</span><span class="p">))</span><span class="o">+</span><span class="n">cv_min</span>
                <span class="n">local_minima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span>
                    <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">bin_min</span><span class="p">,</span> <span class="mi">6</span><span class="p">)],</span> <span class="n">min_cv_b</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">min_cv</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>
                <span class="p">])</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="n">local_minima</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="p">,</span> <span class="n">local_minima</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;No minima found.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">argsort</span><span class="p">()]</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span>
        <span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span>
            <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">minima</span>
        <span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_name</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CV</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)]</span>

    <span class="n">minima_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minima</span><span class="p">),</span>
        <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Minimum&quot;</span><span class="p">,</span> <span class="s2">&quot;free energy&quot;</span><span class="p">]</span> <span class="o">+</span>
        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CV</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">bin&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)]</span> <span class="o">+</span>
        <span class="p">[</span><span class="sa">f</span><span class="s2">&quot;CV</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_name</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">)]</span>
    <span class="p">)</span>
    <span class="n">minima_df</span><span class="p">[</span><span class="s2">&quot;Minimum&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">minima_df</span><span class="p">[</span><span class="s2">&quot;Minimum&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">minima</span> <span class="o">=</span> <span class="n">minima_df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="catflow.metad.fes.FreeEnergySurface.from_hills" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">from_hills</span><span class="p">(</span><span class="n">hills</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

<a href="#catflow.metad.fes.FreeEnergySurface.from_hills" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Generate a FES object from a Hills object.</p>

          <details class="quote">
            <summary>Source code in <code>catflow/metad/fes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_hills</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span> 
    <span class="n">hills</span><span class="p">:</span> <span class="n">Hills</span><span class="p">,</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">256</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate a FES object from a Hills object.&quot;&quot;&quot;</span>
    <span class="n">fes</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">)</span>

    <span class="n">fes</span><span class="o">.</span><span class="n">cvs</span> <span class="o">=</span> <span class="n">hills</span><span class="o">.</span><span class="n">cvs</span>

    <span class="n">fes</span><span class="o">.</span><span class="n">hills</span> <span class="o">=</span> <span class="n">hills</span>
    <span class="n">fes</span><span class="o">.</span><span class="n">periodic</span> <span class="o">=</span> <span class="n">hills</span><span class="o">.</span><span class="n">periodic</span>
    <span class="n">fes</span><span class="o">.</span><span class="n">cv_name</span> <span class="o">=</span> <span class="n">hills</span><span class="o">.</span><span class="n">cv_name</span>

    <span class="n">fes</span><span class="o">.</span><span class="n">generate_cv_map</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fes</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="catflow.metad.fes.FreeEnergySurface.generate_cv_map" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_cv_map</span><span class="p">()</span></code>

<a href="#catflow.metad.fes.FreeEnergySurface.generate_cv_map" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>generate CV map</p>

          <details class="quote">
            <summary>Source code in <code>catflow/metad/fes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_cv_map</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;generate CV map&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cv_min</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">cv_min</span><span class="p">)</span>
        <span class="n">cv_max</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">cv_max</span><span class="p">)</span>
        <span class="n">cv_range</span> <span class="o">=</span> <span class="n">cv_max</span> <span class="o">-</span> <span class="n">cv_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_range</span> <span class="o">=</span> <span class="n">cv_range</span>

        <span class="n">cv_min</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">]</span> <span class="o">-=</span> <span class="n">cv_range</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.15</span>
        <span class="n">cv_max</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">]</span> <span class="o">+=</span> <span class="n">cv_range</span><span class="p">[</span><span class="o">~</span><span class="bp">self</span><span class="o">.</span><span class="n">periodic</span><span class="p">]</span> <span class="o">*</span> <span class="mf">0.15</span>
        <span class="n">cv_fes_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">cv_max</span> <span class="o">-</span> <span class="n">cv_min</span><span class="p">)</span>

        <span class="c1"># generate remapped cv_min and cv_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_min</span> <span class="o">=</span> <span class="n">cv_min</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_max</span> <span class="o">=</span> <span class="n">cv_max</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_fes_range</span> <span class="o">=</span> <span class="n">cv_fes_range</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="catflow.metad.fes.FreeEnergySurface.get_e_beta_c" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_e_beta_c</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">kb</span><span class="o">=</span><span class="mf">0.008314</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mf">300.0</span><span class="p">,</span> <span class="n">bias_factor</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">return_fes</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#catflow.metad.fes.FreeEnergySurface.get_e_beta_c" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Function used internally for summing hills in Hills object with the fast Bias Sum Algorithm. 
From which could also be quick to get e_beta_c for reweighting.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>resolution</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The resolution of the free energy surface. Defaults to 256.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>time_min</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The starting time step of simulation. Defaults to 0.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>time_max</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The ending time step of simulation. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>reweighting</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, the function of c(t) will be calculated and stored in <code>self.e_beta_c</code>.
Defaults to False.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>kb</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Boltzmann Constant in the energy unit. Defaults to 8.314e-3.</p>
            </div>
          </td>
          <td>
                <code>0.008314</code>
          </td>
        </tr>
        <tr>
          <td><code>temp</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The temperature of the simulation in Kelvins. Defaults to 300.0.</p>
            </div>
          </td>
          <td>
                <code>300.0</code>
          </td>
        </tr>
        <tr>
          <td><code>bias_factor</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The bias factor used in the simulation. Defaults to 15.0.</p>
            </div>
          </td>
          <td>
                <code>15.0</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>catflow/metad/fes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_e_beta_c</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">time_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">time_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">kb</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.314e-3</span><span class="p">,</span>
    <span class="n">temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">300.0</span><span class="p">,</span>
    <span class="n">bias_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">15.0</span><span class="p">,</span>
    <span class="n">return_fes</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function used internally for summing hills in Hills object with the fast Bias Sum Algorithm. </span>
<span class="sd">    From which could also be quick to get e_beta_c for reweighting.</span>

<span class="sd">    Args:</span>
<span class="sd">        resolution (int, optional): \</span>
<span class="sd">            The resolution of the free energy surface. Defaults to 256.</span>
<span class="sd">        time_min (int): The starting time step of simulation. Defaults to 0.</span>
<span class="sd">        time_max (int, optional): The ending time step of simulation. Defaults to None.</span>
<span class="sd">        reweighting (bool, optional): \</span>
<span class="sd">            If True, the function of c(t) will be calculated and stored in `self.e_beta_c`.</span>
<span class="sd">            Defaults to False.</span>
<span class="sd">        kb (float, optional): The Boltzmann Constant in the energy unit. Defaults to 8.314e-3.</span>
<span class="sd">        temp (float, optional): The temperature of the simulation in Kelvins. Defaults to 300.0.</span>
<span class="sd">        bias_factor (float, optional): The bias factor used in the simulation. Defaults to 15.0.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Hills not loaded yet.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">time_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">time_min</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">if</span> <span class="n">time_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">time_max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">cv</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

    <span class="n">cvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span>

    <span class="n">cv_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_min</span>
    <span class="n">cv_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_max</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_fes_range</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cv_fes_range</span> <span class="o">=</span> <span class="n">cv_max</span> <span class="o">-</span> <span class="n">cv_min</span>
    <span class="n">cv_fes_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_fes_range</span>

    <span class="n">cv_bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span>
        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">cv</span><span class="p">[</span><span class="n">time_min</span><span class="p">:</span><span class="n">time_max</span><span class="p">,</span> <span class="p">:</span><span class="n">cvs</span><span class="p">]</span> <span class="o">-</span>
         <span class="n">cv_min</span><span class="p">)</span> <span class="o">*</span> <span class="n">resolution</span> <span class="o">/</span> <span class="n">cv_fes_range</span>
    <span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">sigma</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">sigma</span><span class="p">[:</span><span class="n">cvs</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">sigma_res</span> <span class="o">=</span> <span class="p">(</span><span class="n">sigma</span> <span class="o">*</span> <span class="n">resolution</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">cv_max</span> <span class="o">-</span> <span class="n">cv_min</span><span class="p">)</span>

    <span class="n">gauss_res</span> <span class="o">=</span> <span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">sigma_res</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">gauss_res</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">_</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">gauss_res</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">gauss</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_gauss_kernel</span><span class="p">(</span><span class="n">gauss_res</span><span class="p">,</span> <span class="n">sigma_res</span><span class="p">)</span>
    <span class="n">gauss_center</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gauss</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>

    <span class="n">fes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">resolution</span><span class="p">]</span> <span class="o">*</span> <span class="n">cvs</span><span class="p">)</span>
    <span class="n">e_beta_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cv_bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">cv_bins</span><span class="p">[</span><span class="mi">0</span><span class="p">])):</span>
        <span class="n">fes_index_to_edit</span><span class="p">,</span> <span class="n">delta_fes</span> <span class="o">=</span> \
            <span class="bp">self</span><span class="o">.</span><span class="n">_sum_bias</span><span class="p">(</span>
                <span class="n">gauss_center</span><span class="p">,</span> <span class="n">gauss</span><span class="p">,</span> <span class="n">cv_bins</span><span class="p">,</span> <span class="n">line</span><span class="p">,</span> <span class="n">cvs</span><span class="p">,</span> <span class="n">resolution</span>
            <span class="p">)</span>
        <span class="n">fes</span><span class="p">[</span><span class="n">fes_index_to_edit</span><span class="p">]</span> <span class="o">+=</span> <span class="n">delta_fes</span>

        <span class="n">local_fes</span> <span class="o">=</span> <span class="n">fes</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">fes</span><span class="p">)</span>
        <span class="n">exp_local_fes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">local_fes</span> <span class="o">/</span> <span class="p">(</span><span class="n">kb</span> <span class="o">*</span> <span class="n">temp</span><span class="p">))</span>

        <span class="n">numerator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">exp_local_fes</span><span class="p">)</span>
        <span class="n">denominator</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">exp_local_fes</span> <span class="o">/</span> <span class="n">bias_factor</span><span class="p">)</span>
        <span class="n">e_beta_c</span><span class="p">[</span><span class="n">line</span><span class="p">]</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>
    <span class="k">if</span> <span class="n">return_fes</span><span class="p">:</span>
        <span class="n">fes</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">fes</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">e_beta_c</span><span class="p">,</span> <span class="n">fes</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">e_beta_c</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="catflow.metad.fes.FreeEnergySurface.make_fes_original" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">make_fes_original</span><span class="p">(</span><span class="n">resolution</span><span class="p">,</span> <span class="n">time_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">time_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">n_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span></code>

<a href="#catflow.metad.fes.FreeEnergySurface.make_fes_original" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Function internally used to sum Hills in the same way as Plumed <code>sum_hills</code>. </p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>resolution</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The resolution of the free energy surface. Defaults to 256.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>time_min</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The starting time step of simulation. Defaults to 0.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>time_max</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The ending time step of simulation. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>n_workers</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of workers for parallelization. Defaults to 2.</p>
            </div>
          </td>
          <td>
                <code>2</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>catflow/metad/fes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">make_fes_original</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">time_min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">time_max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">n_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function internally used to sum Hills in the same way as Plumed `sum_hills`. </span>

<span class="sd">    Args:</span>
<span class="sd">        resolution (int, optional): \</span>
<span class="sd">            The resolution of the free energy surface. Defaults to 256.</span>
<span class="sd">        time_min (int): The starting time step of simulation. Defaults to 0.</span>
<span class="sd">        time_max (int, optional): The ending time step of simulation. Defaults to None.</span>
<span class="sd">        n_workers (int, optional): Number of workers for parallelization. Defaults to 2.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Hills not loaded yet.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span>

    <span class="n">cvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span>
    <span class="n">fes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">resolution</span><span class="p">]</span> <span class="o">*</span> <span class="n">cvs</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">time_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">time_min</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">if</span> <span class="n">time_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">time_max</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">cv</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">time_limit</span> <span class="o">=</span> <span class="n">time_max</span> <span class="o">-</span> <span class="n">time_min</span>

    <span class="k">def</span> <span class="nf">calculate_fes</span><span class="p">(</span><span class="n">index</span><span class="p">):</span>
        <span class="n">dp2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_dp2</span><span class="p">(</span><span class="n">index</span><span class="p">,</span> <span class="n">time_min</span><span class="p">,</span> <span class="n">time_max</span><span class="p">)</span>

        <span class="n">tmp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">time_limit</span><span class="p">)</span>
        <span class="n">tmp</span><span class="p">[</span><span class="n">dp2</span> <span class="o">&lt;</span> <span class="mf">6.25</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">heights</span><span class="p">[</span><span class="n">dp2</span> <span class="o">&lt;</span> <span class="mf">6.25</span><span class="p">]</span> <span class="o">*</span> \
            <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">dp2</span><span class="p">[</span><span class="n">dp2</span> <span class="o">&lt;</span> <span class="mf">6.25</span><span class="p">])</span> <span class="o">*</span>
             <span class="mf">1.00193418799744762399</span> <span class="o">-</span> <span class="mf">0.00193418799744762399</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">index</span><span class="p">,</span> <span class="o">-</span><span class="n">tmp</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="n">indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndindex</span><span class="p">(</span><span class="n">fes</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=</span><span class="n">n_workers</span><span class="p">)(</span>
        <span class="n">delayed</span><span class="p">(</span><span class="n">calculate_fes</span><span class="p">)(</span><span class="n">index</span><span class="p">)</span> <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span>
    <span class="p">)</span>
    <span class="k">if</span> <span class="n">results</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
            <span class="n">fes</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">fes</span> <span class="o">-=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">fes</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fes</span> <span class="o">=</span> <span class="n">fes</span>
    <span class="k">return</span> <span class="n">fes</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="catflow.metad.fes.FreeEnergySurface.plot" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">png_name</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;RdYlBu_r&#39;</span><span class="p">,</span> <span class="n">energy_unit</span><span class="o">=</span><span class="s1">&#39;kJ/mol&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">levels</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">96</span><span class="p">,</span> <span class="n">surface</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">surface_params</span><span class="o">=</span><span class="p">{},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

<a href="#catflow.metad.fes.FreeEnergySurface.plot" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Visualizes the free energy surface (FES) using Matplotlib and PyVista.</p>
<p>Usage:
<div class="highlight"><pre><span></span><code><span class="n">fes</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div></p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>png_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If provided, the picture of FES will be saved under this name in the current working directory.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>cmap</code></td>
          <td>
                <code>str, default=&#34;RdYlBu_r&#34;</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Matplotlib colormap used to color the 2D or 3D FES.</p>
            </div>
          </td>
          <td>
                <code>&#39;RdYlBu_r&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>energy_unit</code></td>
          <td>
                <code>str, default=&#34;kJ/mol&#34;</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The unit used in the description of the colorbar.</p>
            </div>
          </td>
          <td>
                <code>&#39;kJ/mol&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>xlabel,</code></td>
          <td>
                <code>ylabel (str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If provided, they will be used as labels for the graphs.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>image_size</code></td>
          <td>
                <code>List[int], default=[10,7]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The width and height of the picture.</p>
            </div>
          </td>
          <td>
                <code>[10, 7]</code>
          </td>
        </tr>
        <tr>
          <td><code>levels</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of free energy values for isosurfaces in FES. Defaults to be 20.</p>
            </div>
          </td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr>
          <td><code>dpi</code></td>
          <td>
                <code>int, default=96</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The resolution of the picture.</p>
            </div>
          </td>
          <td>
                <code>96</code>
          </td>
        </tr>
        <tr>
          <td><code>surface</code></td>
          <td>
                <code>bool, default=False</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to plot the 3D surface of the FES.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>surface_params</code></td>
          <td>
                <code>dict</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A dictionary of parameters to be passed to the PyVista plotter when plotting the 3D surface.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
        <tr>
          <td><code>**kwargs</code></td>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Additional keyword arguments to be passed to the Matplotlib plotter.</p>
            </div>
          </td>
          <td>
                <code>{}</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>fig, ax: The Matplotlib figure and axis objects.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>catflow/metad/fes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">png_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">cmap</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Colormap</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;RdYlBu_r&quot;</span><span class="p">,</span>
    <span class="n">energy_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;kJ/mol&quot;</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">image_size</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
    <span class="n">levels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">96</span><span class="p">,</span>
    <span class="n">surface</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="n">surface_params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualizes the free energy surface (FES) using Matplotlib and PyVista.</span>

<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    fes.plot()</span>
<span class="sd">    ```</span>

<span class="sd">    Args:</span>
<span class="sd">        png_name (str, optional): If provided, the picture of FES will be saved under this name in the current working directory.</span>
<span class="sd">        cmap (str, default=&quot;RdYlBu_r&quot;): The Matplotlib colormap used to color the 2D or 3D FES.</span>
<span class="sd">        energy_unit (str, default=&quot;kJ/mol&quot;): The unit used in the description of the colorbar.</span>
<span class="sd">        xlabel, ylabel (str, optional): If provided, they will be used as labels for the graphs.</span>
<span class="sd">        image_size (List[int], default=[10,7]): The width and height of the picture.</span>
<span class="sd">        levels (int, optional): A list of free energy values for isosurfaces in FES. Defaults to be 20.</span>
<span class="sd">        dpi (int, default=96): The resolution of the picture.</span>
<span class="sd">        surface (bool, default=False): Whether to plot the 3D surface of the FES.</span>
<span class="sd">        surface_params (dict, optional): A dictionary of parameters to be passed to the PyVista plotter when plotting the 3D surface.</span>
<span class="sd">        **kwargs: Additional keyword arguments to be passed to the Matplotlib plotter.</span>

<span class="sd">    Returns:</span>
<span class="sd">        fig, ax: The Matplotlib figure and axis objects.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">matplotlib.cm</span> <span class="k">as</span> <span class="nn">cm</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;FES not calculated yet. Use makefes() or makefes2() first.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">cmap</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="n">cmap</span><span class="p">)</span>

    <span class="n">cvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span>

    <span class="k">if</span> <span class="n">cvs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">PlottingFES</span><span class="o">.</span><span class="n">_plot1d</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
            <span class="n">energy_unit</span><span class="o">=</span><span class="n">energy_unit</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">elif</span> <span class="n">cvs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">surface</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">PlottingFES</span><span class="o">.</span><span class="n">_surface_plot</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">,</span>
                <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
                <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
                <span class="n">energy_unit</span><span class="o">=</span><span class="n">energy_unit</span><span class="p">,</span>
                <span class="o">**</span><span class="n">surface_params</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
            <span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">PlottingFES</span><span class="o">.</span><span class="n">_plot2d</span><span class="p">(</span>
            <span class="bp">self</span><span class="p">,</span>
            <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span> <span class="n">image_size</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
            <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
        <span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Only 1D and 2D FES are supported.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">png_name</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">png_name</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="catflow.metad.fes.FreeEnergySurface.remove_cv" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">remove_cv</span><span class="p">(</span><span class="n">CV</span><span class="p">,</span> <span class="n">kb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">energy_unit</span><span class="o">=</span><span class="s1">&#39;kJ/mol&#39;</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mf">300.0</span><span class="p">)</span></code>

<a href="#catflow.metad.fes.FreeEnergySurface.remove_cv" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Remove a CV from an existing FES. 
The function first recalculates the FES to an array of probabilities. 
The probabilities are summed along the CV to be removed, 
and resulting probability distribution with 1 less dimension 
is converted back to FES. </p>
<p>Interactivity was working in jupyter notebook/lab with "%matplotlib widget".</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>CV</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the index of CV to be removed. </p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>energy_unit</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>has to be either "kJ/mol" or "kcal/mol". Defaults to be "kJ/mol".</p>
            </div>
          </td>
          <td>
                <code>&#39;kJ/mol&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>kb</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>the Boltzmann Constant in the energy unit.                 Defaults to be None, which will be set according to energy_unit.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

<details class="return" open>
  <summary>Return</summary>
  <p>New <code>FES</code> instance without the CV to be removed.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>catflow/metad/fes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_cv</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">CV</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">kb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">energy_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;kJ/mol&quot;</span><span class="p">,</span>
    <span class="n">temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">300.0</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove a CV from an existing FES. </span>
<span class="sd">    The function first recalculates the FES to an array of probabilities. </span>
<span class="sd">    The probabilities are summed along the CV to be removed, </span>
<span class="sd">    and resulting probability distribution with 1 less dimension </span>
<span class="sd">    is converted back to FES. </span>

<span class="sd">    Interactivity was working in jupyter notebook/lab with &quot;%matplotlib widget&quot;.</span>

<span class="sd">    Args:</span>
<span class="sd">        CV (int): the index of CV to be removed. </span>
<span class="sd">        energy_unit (str): has to be either &quot;kJ/mol&quot; or &quot;kcal/mol&quot;. Defaults to be &quot;kJ/mol&quot;.</span>
<span class="sd">        kb (float, optional): the Boltzmann Constant in the energy unit. \</span>
<span class="sd">            Defaults to be None, which will be set according to energy_unit.</span>
<span class="sd">        temp (float) = temperature of the simulation in Kelvins.</span>

<span class="sd">    Return:</span>
<span class="sd">        New `FES` instance without the CV to be removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing CV </span><span class="si">{</span><span class="n">CV</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">fes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;FES not calculated yet. Use makefes() or makefes2() first.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">CV</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="o">.</span><span class="n">cvs</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Error: The CV to remove is not available in this FES object.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">kb</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">energy_unit</span> <span class="o">==</span> <span class="s2">&quot;kJ/mol&quot;</span><span class="p">:</span>
            <span class="n">kb</span> <span class="o">=</span> <span class="mf">8.314e-3</span>
        <span class="k">elif</span> <span class="n">energy_unit</span> <span class="o">==</span> <span class="s2">&quot;kcal/mol&quot;</span><span class="p">:</span>
            <span class="n">kb</span> <span class="o">=</span> <span class="mf">8.314e-3</span> <span class="o">/</span> <span class="mf">4.184</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;Please give the Boltzmann Constant in the energy unit.&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: You can not remove the only CV. &quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">probabilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">fes</span> <span class="o">/</span> <span class="p">(</span><span class="n">kb</span> <span class="o">*</span> <span class="n">temp</span><span class="p">))</span>
        <span class="n">new_prob</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">CV</span><span class="p">)</span>

        <span class="n">new_fes</span> <span class="o">=</span> <span class="n">FreeEnergySurface</span><span class="o">.</span><span class="n">from_hills</span><span class="p">(</span><span class="n">hills</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">hills</span><span class="p">)</span>
        <span class="n">new_fes</span><span class="o">.</span><span class="n">fes</span> <span class="o">=</span> <span class="o">-</span> <span class="n">kb</span> <span class="o">*</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">new_prob</span><span class="p">)</span>
        <span class="n">new_fes</span><span class="o">.</span><span class="n">fes</span> <span class="o">=</span> <span class="n">new_fes</span><span class="o">.</span><span class="n">fes</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">new_fes</span><span class="o">.</span><span class="n">fes</span><span class="p">)</span>
        <span class="n">new_fes</span><span class="o">.</span><span class="n">res</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">res</span>

        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cvs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">)</span>
        <span class="n">mask</span><span class="p">[</span><span class="n">CV</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="n">new_fes</span><span class="o">.</span><span class="n">cv_min</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_min</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">new_fes</span><span class="o">.</span><span class="n">cv_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_max</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">new_fes</span><span class="o">.</span><span class="n">cv_fes_range</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cv_fes_range</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">new_fes</span><span class="o">.</span><span class="n">cv_name</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">j</span> <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cv_name</span><span class="p">)</span> <span class="k">if</span> <span class="n">mask</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
        <span class="n">new_fes</span><span class="o">.</span><span class="n">cvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">new_fes</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="catflow.metad.fes.FreeEnergySurface.remove_cvs" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">remove_cvs</span><span class="p">(</span><span class="n">CVs</span><span class="p">,</span> <span class="n">kb</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">energy_unit</span><span class="o">=</span><span class="s1">&#39;kJ/mol&#39;</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mf">300.0</span><span class="p">)</span></code>

<a href="#catflow.metad.fes.FreeEnergySurface.remove_cvs" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Remove multiple collective variables (CVs) from the free energy surface (FES).</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>CVs</code></td>
          <td>
                <code><span title="typing.List">List</span>[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The list of CVs to be removed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>kb</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Boltzmann constant. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>energy_unit</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The unit of energy. Defaults to "kJ/mol".</p>
            </div>
          </td>
          <td>
                <code>&#39;kJ/mol&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>temp</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The temperature in Kelvin. Defaults to 300.0.</p>
            </div>
          </td>
          <td>
                <code>300.0</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>Fes</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The new FES object with the specified CVs removed.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>catflow/metad/fes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_cvs</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">CVs</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
    <span class="n">kb</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">energy_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;kJ/mol&quot;</span><span class="p">,</span>
    <span class="n">temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">300.0</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove multiple collective variables (CVs) from the free energy surface (FES).</span>

<span class="sd">    Args:</span>
<span class="sd">        CVs (List[int]): The list of CVs to be removed.</span>
<span class="sd">        kb (Optional[float], optional): The Boltzmann constant. Defaults to None.</span>
<span class="sd">        energy_unit (str, optional): The unit of energy. Defaults to &quot;kJ/mol&quot;.</span>
<span class="sd">        temp (float, optional): The temperature in Kelvin. Defaults to 300.0.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Fes: The new FES object with the specified CVs removed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">remove_cv</span><span class="p">(</span><span class="n">CVs</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">kb</span><span class="p">,</span> <span class="n">energy_unit</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">CVs</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">CV</span> <span class="ow">in</span> <span class="n">CVs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">fes</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">fes</span> <span class="o">=</span> <span class="n">fes</span><span class="o">.</span><span class="n">remove_cv</span><span class="p">(</span><span class="n">CV</span><span class="p">,</span> <span class="n">kb</span><span class="p">,</span> <span class="n">energy_unit</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fes</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h3 id="catflow.metad.fes.FreeEnergySurface.reweighting" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">reweighting</span><span class="p">(</span><span class="n">colvar_file</span><span class="p">,</span> <span class="n">e_beta_c</span><span class="p">,</span> <span class="n">cv_indexes</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span> <span class="n">kb</span><span class="o">=</span><span class="mf">0.008314</span><span class="p">,</span> <span class="n">temp</span><span class="o">=</span><span class="mf">300.0</span><span class="p">)</span></code>

<a href="#catflow.metad.fes.FreeEnergySurface.reweighting" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Reweights the free energy surface based on the given collective variables.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>colvar_file</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The path to the file containing the collective variables.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>e_beta_c</code></td>
          <td>
                <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The array of e^(-beta*C(t)) values.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>cv_indexes</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.List">List</span>[int]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The indexes of the collective variables to use. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>resolution</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The resolution of the free energy surface. Defaults to 64.</p>
            </div>
          </td>
          <td>
                <code>64</code>
          </td>
        </tr>
        <tr>
          <td><code>kb</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The Boltzmann constant. Defaults to 8.314e-3.</p>
            </div>
          </td>
          <td>
                <code>0.008314</code>
          </td>
        </tr>
        <tr>
          <td><code>temp</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The temperature in Kelvin. Defaults to 300.0.</p>
            </div>
          </td>
          <td>
                <code>300.0</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>np.ndarray: The reweighted free energy surface.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>catflow/metad/fes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reweighting</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">colvar_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">e_beta_c</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
    <span class="n">cv_indexes</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">64</span><span class="p">,</span>
    <span class="n">kb</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">8.314e-3</span><span class="p">,</span>
    <span class="n">temp</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">300.0</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reweights the free energy surface based on the given collective variables.</span>

<span class="sd">    Args:</span>
<span class="sd">        colvar_file (str): The path to the file containing the collective variables.</span>
<span class="sd">        e_beta_c (ArrayLike): The array of e^(-beta*C(t)) values.</span>
<span class="sd">        cv_indexes (Optional[List[int]], optional): The indexes of the collective variables to use. Defaults to None.</span>
<span class="sd">        resolution (int, optional): The resolution of the free energy surface. Defaults to 64.</span>
<span class="sd">        kb (float, optional): The Boltzmann constant. Defaults to 8.314e-3.</span>
<span class="sd">        temp (float, optional): The temperature in Kelvin. Defaults to 300.0.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: The reweighted free energy surface.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">colvar</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">colvar_file</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">cv_indexes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">cvs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cvs</span>
        <span class="n">colvar_value</span> <span class="o">=</span> <span class="n">colvar</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:</span><span class="n">cvs</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">cvs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cv_indexes</span><span class="p">)</span>
        <span class="n">colvar_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span>
            <span class="p">[</span><span class="n">colvar</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">cv_indexes</span><span class="p">]</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">cv_array</span> <span class="o">=</span> <span class="n">colvar_value</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">colvar_value</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">cv_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">cv_array</span><span class="p">)</span>
    <span class="n">cv_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">((</span><span class="n">resolution</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">cv_array</span> <span class="o">/</span> <span class="n">cv_range</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">bias</span> <span class="o">=</span> <span class="n">colvar</span><span class="p">[:,</span> <span class="mi">9</span><span class="p">]</span>
    <span class="n">probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="n">resolution</span><span class="p">]</span> <span class="o">*</span> <span class="n">cvs</span><span class="p">)</span>

    <span class="n">e_beta_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">e_beta_c</span><span class="p">)</span>
    <span class="n">reweighted_fes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">e_beta_c</span><span class="p">)]</span> <span class="o">+</span> <span class="p">[</span><span class="n">resolution</span><span class="p">]</span> <span class="o">*</span> <span class="n">cvs</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">e_beta_c</span><span class="p">)):</span>
        <span class="n">index</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">cv_array</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">probs</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">+=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">bias</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">kb</span> <span class="o">*</span> <span class="n">temp</span><span class="p">))</span> <span class="o">/</span> <span class="n">e_beta_c</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">reweighted_fes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">kb</span> <span class="o">*</span> <span class="n">temp</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">probs</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">reweighted_fes</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">




<h2 id="catflow.metad.fes.PlottingFES" class="doc doc-heading">
          <code>PlottingFES</code>


<a href="#catflow.metad.fes.PlottingFES" class="headerlink" title="Permanent link">&para;</a></h2>


  <div class="doc doc-contents ">

  
      <p>A class that provides methods for plotting free energy surfaces (FES) from a FES object.</p>

            <details class="quote">
              <summary>Source code in <code>catflow/metad/fes.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">PlottingFES</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    A class that provides methods for plotting free energy surfaces (FES) from a FES object.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_surface_plot</span><span class="p">(</span>
        <span class="n">fes</span><span class="p">:</span> <span class="n">FreeEnergySurface</span><span class="p">,</span>
        <span class="n">cmap</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Colormap</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;RdYlBu&quot;</span><span class="p">,</span>
        <span class="n">energy_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;kJ/mol&quot;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">zlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">label_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span>
        <span class="n">image_size</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
        <span class="n">rstride</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">cstride</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">96</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualizes the 2D free energy surface (FES) as a 3D surface plot using Matplotlib.</span>

<span class="sd">        Note: Interactivity is currently limited to jupyter notebook or jupyter lab in `%matplotlib widget` mode. Otherwise, it is a static image of the 3D surface plot.</span>

<span class="sd">        Usage:</span>
<span class="sd">        ```python</span>
<span class="sd">        %matplotlib widget</span>
<span class="sd">        fes.surface_plot()</span>
<span class="sd">        ```</span>

<span class="sd">        Future plans include implementing this function using PyVista. However, in the current version of PyVista (0.38.5), there is an issue with labels on the 3rd axis for free energy showing wrong values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">fes</span><span class="o">.</span><span class="n">cv_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fes</span><span class="o">.</span><span class="n">name_cv</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">fes</span><span class="o">.</span><span class="n">cvs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">cv_min</span> <span class="o">=</span> <span class="n">fes</span><span class="o">.</span><span class="n">cv_min</span>
            <span class="n">cv_max</span> <span class="o">=</span> <span class="n">fes</span><span class="o">.</span><span class="n">cv_max</span>

            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cv_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">cv_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fes</span><span class="o">.</span><span class="n">res</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cv_min</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">cv_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fes</span><span class="o">.</span><span class="n">res</span><span class="p">)</span>

            <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">Z</span> <span class="o">=</span> <span class="n">fes</span><span class="o">.</span><span class="n">fes</span>

            <span class="n">canvas_style</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
                <span class="n">figsize</span><span class="o">=</span><span class="n">image_size</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span><span class="p">,</span>
                <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;projection&quot;</span><span class="p">:</span> <span class="s2">&quot;3d&quot;</span><span class="p">}</span>
            <span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot_surface</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">,</span>  <span class="c1"># type: ignore</span>
                            <span class="n">rstride</span><span class="o">=</span><span class="n">rstride</span><span class="p">,</span> <span class="n">cstride</span><span class="o">=</span><span class="n">cstride</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">xlabel</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;CV1 - </span><span class="si">{</span><span class="n">fes</span><span class="o">.</span><span class="n">cv_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span> <span class="c1"># type: ignore</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">ylabel</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;CV2 - </span><span class="si">{</span><span class="n">fes</span><span class="o">.</span><span class="n">cv_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span> <span class="c1"># type: ignore</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">zlabel</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Free energy (</span><span class="si">{</span><span class="n">energy_unit</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span> <span class="c1"># type: ignore</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="n">zlabel</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">label_size</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Surface plot only works for FES with exactly two CVs, and this FES has </span><span class="si">{</span><span class="n">fes</span><span class="o">.</span><span class="n">cvs</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_plot1d</span><span class="p">(</span>
        <span class="n">fes</span><span class="p">:</span> <span class="n">FreeEnergySurface</span><span class="p">,</span>
        <span class="n">image_size</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
        <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">96</span><span class="p">,</span>
        <span class="n">energy_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;kJ/mol&#39;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
        <span class="n">canvas_style</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span>
        <span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fes</span><span class="o">.</span><span class="n">cv_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fes</span><span class="o">.</span><span class="n">cv_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fes</span><span class="o">.</span><span class="n">res</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">fes</span><span class="o">.</span><span class="n">fes</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xlabel</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;CV1 - </span><span class="si">{</span><span class="n">fes</span><span class="o">.</span><span class="n">cv_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># type: ignore</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ylabel</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Free Energy (</span><span class="si">{</span><span class="n">energy_unit</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_plot2d</span><span class="p">(</span>
        <span class="n">fes_obj</span><span class="p">:</span> <span class="n">FreeEnergySurface</span><span class="p">,</span>
        <span class="n">levels</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">cmap</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Colormap</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;RdYlBu&quot;</span><span class="p">,</span>
        <span class="n">image_size</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
        <span class="n">dpi</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">96</span><span class="p">,</span>
        <span class="n">energy_unit</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;kJ/mol&#39;</span><span class="p">,</span>
        <span class="n">xlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">zlabel</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a filled contour plot of the energy landscape $V$.</span>

<span class="sd">        Args:</span>
<span class="sd">            cmap: Colormap for plot.</span>
<span class="sd">            levels: Levels to plot contours at (see matplotlib contour/contourf docs for details).</span>
<span class="sd">            dpi: DPI.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

        <span class="n">canvas_style</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
            <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="n">image_size</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">image_size</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
            <span class="n">dpi</span><span class="o">=</span><span class="n">dpi</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">fes</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;FES not calculated yet. Use fes.makefes() or fes.makefes2() first.&quot;</span><span class="p">)</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">cv_min</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">cv_max</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">res</span><span class="p">)</span>
        <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">cv_min</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">cv_max</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">res</span><span class="p">)</span>
        <span class="n">fes</span> <span class="o">=</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">fes</span><span class="o">.</span><span class="n">T</span>
        <span class="n">cs</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">fes</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">fes</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="n">levels</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">xlabel</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;CV1 - </span><span class="si">{</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">cv_name</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">ylabel</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;CV2 - </span><span class="si">{</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">cv_name</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">ylabel</span><span class="p">)</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">cs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">zlabel</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Free Energy (</span><span class="si">{</span><span class="n">energy_unit</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="n">zlabel</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">plot_minima</span><span class="p">(</span>
        <span class="n">fes_obj</span><span class="p">:</span> <span class="n">FreeEnergySurface</span><span class="p">,</span>
        <span class="n">mark_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function used to visualize the FES objects with the positions of local minima shown as letters on the graph.</span>

<span class="sd">        Usage:</span>
<span class="sd">        ```python</span>
<span class="sd">        minima.plot()</span>
<span class="sd">        ```</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No minima found.&quot;</span><span class="p">)</span>

        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="n">free_energy_range</span> <span class="o">=</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">fes</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">fes</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">cvs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> 
                    <span class="nb">float</span><span class="p">(</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">free_energy_range</span><span class="o">*</span><span class="mf">0.05</span><span class="p">,</span> 
                    <span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                    <span class="n">c</span><span class="o">=</span><span class="n">mark_color</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span>
                <span class="p">)</span>

        <span class="k">elif</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">cvs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> 
                    <span class="nb">float</span><span class="p">(</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> 
                    <span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                    <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                    <span class="n">c</span><span class="o">=</span><span class="n">mark_color</span>
                <span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h3 id="catflow.metad.fes.PlottingFES.plot_minima" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">plot_minima</span><span class="p">(</span><span class="n">fes_obj</span><span class="p">,</span> <span class="n">mark_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#catflow.metad.fes.PlottingFES.plot_minima" class="headerlink" title="Permanent link">&para;</a></h3>


  <div class="doc doc-contents ">
  
      <p>Function used to visualize the FES objects with the positions of local minima shown as letters on the graph.</p>
<p>Usage:
<div class="highlight"><pre><span></span><code><span class="n">minima</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</code></pre></div></p>

          <details class="quote">
            <summary>Source code in <code>catflow/metad/fes.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@staticmethod</span>
<span class="k">def</span> <span class="nf">plot_minima</span><span class="p">(</span>
    <span class="n">fes_obj</span><span class="p">:</span> <span class="n">FreeEnergySurface</span><span class="p">,</span>
    <span class="n">mark_color</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;white&quot;</span><span class="p">,</span>
    <span class="o">**</span><span class="n">kwargs</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function used to visualize the FES objects with the positions of local minima shown as letters on the graph.</span>

<span class="sd">    Usage:</span>
<span class="sd">    ```python</span>
<span class="sd">    minima.plot()</span>
<span class="sd">    ```</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No minima found.&quot;</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">free_energy_range</span> <span class="o">=</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">fes</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">fes</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">cvs</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">3</span><span class="p">]),</span> 
                <span class="nb">float</span><span class="p">(</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">free_energy_range</span><span class="o">*</span><span class="mf">0.05</span><span class="p">,</span> 
                <span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                <span class="n">c</span><span class="o">=</span><span class="n">mark_color</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span>
            <span class="p">)</span>

    <span class="k">elif</span> <span class="n">fes_obj</span><span class="o">.</span><span class="n">cvs</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">index</span><span class="p">)):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
                <span class="nb">float</span><span class="p">(</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">4</span><span class="p">]),</span> 
                <span class="nb">float</span><span class="p">(</span><span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">5</span><span class="p">]),</span> 
                <span class="n">fes_obj</span><span class="o">.</span><span class="n">minima</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">m</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> 
                <span class="n">c</span><span class="o">=</span><span class="n">mark_color</span>
            <span class="p">)</span>
    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.tabs.sticky", "navigation.top"], "search": "../../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.6c14ae12.min.js"></script>
      
        <script src="../../../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>